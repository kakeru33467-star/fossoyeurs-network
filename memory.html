<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vérification Cognitive</title>
<link rel="stylesheet" href="style.css">

<style>

.memory-container {
    padding:40px;
    text-align:center;
}

/* -------- PHASE 1 -------- */

.memory-grid {
    display:grid;
    grid-template-columns:repeat(5,120px);
    gap:15px;
    justify-content:center;
    margin-top:40px;
}

.memory-card {
    width:120px;
    height:160px;
    perspective:1000px;
    cursor:pointer;
}

.memory-inner {
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transition:transform 0.5s;
}

.memory-card.flipped .memory-inner {
    transform:rotateY(180deg);
}

.face, .back {
    position:absolute;
    width:100%;
    height:100%;
    backface-visibility:hidden;
}

.face img,
.back img {
    width:100%;
    height:100%;
    object-fit:cover;
}

.back {
    transform:rotateY(180deg);
}

/* -------- PHASE 2 -------- */

.assignment-zone {
    display:flex;
    justify-content:center;
    gap:25px;
    margin-top:40px;
}

.drop-slot {
    width:140px;
    height:180px;
    border:1px dashed #555;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    font-size:11px;
    color:#777;
}

.cards-zone {
    display:flex;
    justify-content:center;
    align-items:center;
    gap:40px;
    margin-top:60px;
}

.shuffle-card {
    width:140px;
    height:180px;
    perspective:1000px;
    cursor:grab;
}

.shuffle-inner {
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transition:transform 0.6s;
}

.shuffle-card.revealed .shuffle-inner {
    transform:rotateY(180deg);
}

</style>
</head>
<body>

<div class="memory-container">
<h1>VÉRIFICATION COGNITIVE</h1>
<p class="subtitle">Étape 1 — Association</p>
<div class="memory-grid" id="memoryGrid"></div>
</div>

<script>

/* -------- PHASE 1 -------- */

const characters = [
"soma_toma.jpg",
"Sahir.jpg",
"Reikuro.jpg",
"Tatsumaki.jpg",
"Shu.jpg"
];

let cards = [...characters, ...characters];
cards.sort(()=>Math.random()-0.5);

const grid = document.getElementById("memoryGrid");

let flipped=[];
let matched=0;

cards.forEach(img=>{

    const card=document.createElement("div");
    card.classList.add("memory-card");

    card.innerHTML=`
        <div class="memory-inner">
            <div class="face">
                <img src="images/card_back.jpg">
            </div>
            <div class="back">
                <img src="images/${img}">
            </div>
        </div>
    `;

    card.addEventListener("click",()=>{

        if(card.classList.contains("flipped")||flipped.length===2) return;

        card.classList.add("flipped");
        flipped.push({card,img});

        if(flipped.length===2){
            if(flipped[0].img===flipped[1].img){
                matched++;
                flipped=[];
                if(matched===characters.length){
                    setTimeout(startPhase2,1200);
                }
            }else{
                setTimeout(()=>{
                    flipped.forEach(c=>c.card.classList.remove("flipped"));
                    flipped=[];
                },800);
            }
        }
    });

    grid.appendChild(card);
});

/* -------- PHASE 2 -------- */

function startPhase2(){

    document.querySelector("h1").innerText="RECONSTITUTION IDENTITAIRE";
    document.querySelector(".subtitle").innerText="Suivez les cartes attentivement";

    grid.remove();

    const container=document.querySelector(".memory-container");

    const assignmentZone=document.createElement("div");
    assignmentZone.classList.add("assignment-zone");

    const targets=[
        {name:"Soma & Thomas",img:"soma_toma.jpg"},
        {name:"Sahir",img:"Sahir.jpg"},
        {name:"Raikuro",img:"Reikuro.jpg"},
        {name:"Tatsumaki",img:"Tatsumaki.jpg"}
    ];

    targets.forEach(t=>{
        const slot=document.createElement("div");
        slot.classList.add("drop-slot");
        slot.dataset.correct=t.img;
        slot.innerHTML=`<strong>${t.name}</strong>`;
        slot.addEventListener("dragover",e=>e.preventDefault());
        slot.addEventListener("drop",e=>{
            const img=e.dataTransfer.getData("text");
            slot.innerHTML=`<img src="images/${img}" style="width:100%;height:100%;object-fit:cover;">`;
            slot.dataset.filled=img;
            checkCompletion();
        });
        assignmentZone.appendChild(slot);
    });

    container.appendChild(assignmentZone);

    const cardsZone=document.createElement("div");
    cardsZone.classList.add("cards-zone");
    cardsZone.style.display="flex";
    cardsZone.style.justifyContent="center";
    cardsZone.style.gap="40px";
    cardsZone.style.marginTop="60px";
    container.appendChild(cardsZone);

    let shuffled=[...targets];
    shuffled.sort(()=>Math.random()-0.5);

    shuffled.forEach(t=>{
        const card=document.createElement("div");
        card.classList.add("shuffle-card");
        card.dataset.img=t.img;

        card.innerHTML=`
            <div class="shuffle-inner">
                <div class="face">
                    <img src="images/${t.img}">
                </div>
                <div class="back">
                    <img src="images/card_back.jpg">
                </div>
            </div>
        `;

        cardsZone.appendChild(card);
    });

    const cards=[...document.querySelectorAll(".shuffle-card")];

    // 1️⃣ On laisse visibles 2 secondes
    setTimeout(()=>{

        // 2️⃣ On retourne face cachée
        cards.forEach(c=>{
            c.querySelector(".shuffle-inner").style.transform="rotateY(180deg)";
        });

        // 3️⃣ Mélange façon gobelet (swap réel DOM)
        setTimeout(()=>{

            let swaps=8;
            let count=0;

            const shuffleInterval=setInterval(()=>{

                const a=Math.floor(Math.random()*4);
                let b=Math.floor(Math.random()*4);
                if(a===b) b=(b+1)%4;

                const parent=cardsZone;

                parent.insertBefore(cards[b], cards[a]);

                // on met à jour le tableau
                const temp=cards[a];
                cards[a]=cards[b];
                cards[b]=temp;

                count++;

                if(count>=swaps){
                    clearInterval(shuffleInterval);

                    // Activer drag
                    cards.forEach(c=>{
                        c.draggable=true;
                        c.addEventListener("dragstart",e=>{
                            e.dataTransfer.setData("text",c.dataset.img);
                        });
                    });
                }

            },800);

        },800);

    },2000);
}
</script>

</body>
</html>
